# Relationship Design

As we change to a more distributed object model, the idea of a direct relationship via a teamId or ownerId becomes harder to maintain on every object. It also makes it hard to expand the layers that could potentially relate to an object (hierarchy) but also hard to query for a mapping.

## Model 1

In the first iteration we planned on adding a relationship mapping to the various layers of the system i.e. User, Team, System, Global, etc.

```json
"relationships" : [{
        "type": "workflow",
        "relationship":"owner",
        "id": "12345"
    }],
```

## Model 2

As we expanded on this concept and looked into Gremlin / Mongo graph relationships using vertex and edge

### Vertex (Node)

A node describes a data entity.

A typical data structure would create the following, however it is entirely flexible and can be of any type of entity. We could utilise the current objects such as Team and User, however we don't have matching data structures for Global or System.

```json
{
  "_id": "<generated>",
  "orgRef": "Organization for the vertex",
  "vertexRef": "123",
  "label": "organization|team|user|global|system|workflow|task|token?",
  "attributes": {
    "key": "value"
  }
}
```

| Element      | Description or Mapping                                                                                                                                       |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `_id`        | Generated by MongoDB                                                                                                                                         |
| `orgRef`     | Technically we could use a Node for the Organisation but we would have to traverse the Graph for all objects in that Organisation. _Potentially remove this_ |
| `vertexRef`  | The link to the MongoDB related object                                                                                                                       |
| `label`      | The type of the Node / Vertex                                                                                                                                |
| `attributes` | Additional data that is needed to be stored                                                                                                                  |

### Edge (Relationship)

An edge stores the relationship between two vertex (or nodes). An edge has a from and to node and describes the type of relationship between the entities.

Data structure for edge:

```json
{
  "_id": "<generated>",
  "orgRef": "Organization for the vertex",
  "fromRef": "1231241412",
  "toRef": "124124214124212",
  "label": "member-of|belongs-to|has-member",
  "attributes": {
    "key": "Value"
  }
}
```

## Reference

- [Getting Started with Graph Databases: Azure CosmosDB with Gremlin API](https://itnext.io/getting-started-with-graph-databases-azure-cosmosdb-with-gremlin-api-and-python-80e57cbd1c5e)
- [MongoDB Graph Database](https://www.mongodb.com/databases/mongodb-graph-database)
- [MongoDB graphLookup](https://www.mongodb.com/docs/v4.4/reference/operator/aggregation/graphLookup/)
- [Spring Data Gremlin](https://github.com/gjrwebber/spring-data-gremlin)
